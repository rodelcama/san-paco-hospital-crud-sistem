<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>San Paco | Editar Cita Médica B.D.</title>
  <link rel="stylesheet" href="../CSS/gestion-bd-citas-editar.css" />
</head>

<body>
  <nav class="navbar">
    <div class="navbar-logo-nombre-centro">
      <img src="../Images/logo.jpg" alt="Logo San Paco" class="navbar-logo" />
      <span class="navbar-title">Hospital San Paco</span>
    </div>
  </nav>

  <header>
    <div class="system-info titulos">
      <strong>Sistema de Información Web</strong>
      <span class="dashboard-title">San Paco Hospital CRUD System</span>
      <p>Agendamiento de Citas Médicas para los Pacientes del Hospital San Paco<br />Bogotá D.C.</p>
    </div>
    <div class="modulo-header titulos">
      <h2>MÓDULO 2. GESTIÓN DE BASES DE DATOS</h2>
      <p class="breadcrumb">Citas Médicas - Editar</p>
    </div>
  </header>

  <main>
    <section class="gestion-section">
      <form class="gestion-form" autocomplete="off" onsubmit="buscarCita(event)">
        <fieldset class="seccion buscador">
          <legend>Buscar cita médica a editar</legend>
          <label for="buscar-opcion">Buscar por:</label>
          <select id="buscar-opcion" name="buscar-opcion">
            <option value="codigo-cita">Código de cita</option>
            <option value="documento-paciente">Documento del paciente</option>
            <option value="id-paciente">ID del paciente</option>
          </select>
          <input type="text" id="input-busqueda" name="input-busqueda" placeholder="Ingrese dato de búsqueda" required>
          <button type="submit" class="accion-btn buscar">BUSCAR</button>
          <div id="mensaje-busqueda" class="mensaje-paciente"></div>
        </fieldset>

        <fieldset class="seccion seccion-paciente">
          <legend>Datos del Paciente</legend>
          <label for="nombres-paciente">Nombres del Paciente:</label>
          <input type="text" id="nombres-paciente" name="nombres-paciente" disabled placeholder="Nombres">

          <label for="apellidos-paciente">Apellidos del Paciente:</label>
          <input type="text" id="apellidos-paciente" name="apellidos-paciente" disabled placeholder="Apellidos">

          <label for="tipo-doc-paciente">Tipo de Documento:</label>
          <input type="text" id="tipo-doc-paciente" name="tipo-doc-paciente" disabled placeholder="Tipo de documento">

          <label for="num-doc-paciente">Número de Documento:</label>
          <input type="text" id="num-doc-paciente" name="num-doc-paciente" disabled placeholder="Número de documento">
        </fieldset>

        <fieldset class="seccion">
          <legend>Identificación de la Cita</legend>
          <label for="codigo-cita">Código de Cita Médica:</label>
          <input type="text" id="codigo-cita" name="codigo-cita" disabled placeholder="Código de la cita">
        </fieldset>

        <fieldset class="seccion">
          <legend>Tipo de Cita y Especialización</legend>
          <label for="tipo-cita">Tipo de Cita Médica:</label>
          <select id="tipo-cita" name="tipo-cita">
            <option value="">Seleccione...</option>
            <option value="primera-vez">Primera Vez</option>
            <option value="control">Control</option>
            <option value="consulta">Consulta</option>
            <option value="especialista">Especialista</option>
            <option value="urgencia">Urgencia</option>
          </select>

          <label for="especialidad">Especialidad:</label>
          <select id="especialidad" name="especialidad" onchange="filtrarMedicos()">
            <option value="">Seleccione especialidad...</option>
            <option value="cardiologia">Cardiología</option>
            <option value="pediatria">Pediatría</option>
            <option value="neurologia">Neurología</option>
            <option value="dermatologia">Dermatología</option>
            <option value="traumatologia">Traumatología</option>
            <option value="oftalmologia">Oftalmología</option>
          </select>

          <label for="medico">Médico:</label>
          <select id="medico" name="medico" onchange="cargarDisponibilidad()">
            <option value="">Seleccione médico...</option>
          </select>
        </fieldset>

        <fieldset class="seccion">
          <legend>Programación de la Cita</legend>
          <label for="fecha-cita">Fecha de la Cita:</label>
          <input type="date" id="fecha-cita" name="fecha-cita" onchange="verificarDisponibilidad()">

          <label for="hora-cita">Hora de la Cita:</label>
          <select id="hora-cita" name="hora-cita">
            <option value="">Seleccione fecha y médico...</option>
          </select>

          <label for="estado-cita">Estado de la Cita:</label>
          <select id="estado-cita" name="estado-cita">
            <option value="agendada">Agendada</option>
            <option value="confirmada">Confirmada</option>
            <option value="cancelada">Cancelada</option>
            <option value="reprogramada">Reprogramada</option>
            <option value="atendida">Atendida</option>
          </select>
        </fieldset>

        <fieldset class="seccion">
          <legend>Clasificación y Observaciones</legend>
          <label for="motivo">Motivo de la Cita:</label>
          <select id="motivo" name="motivo">
            <option value="">Seleccione...</option>
            <option value="cita-recurrente">Cita Recurrente Mensual</option>
            <option value="cita-adicional">Cita Adicional</option>
            <option value="control-general">Control General</option>
            <option value="seguimiento">Seguimiento Médico</option>
            <option value="revision-resultados">Revisión de Resultados</option>
            <option value="otro">Otro</option>
          </select>

          <label for="observaciones">Observaciones:</label>
          <textarea id="observaciones" name="observaciones" rows="3" maxlength="500"></textarea>
          <div class="contador-caracteres">0 / 500 caracteres</div>
        </fieldset>

        <div class="botones-accion">
          <button type="button" class="accion-btn guardar" onclick="guardarCambios()">GUARDAR CAMBIOS</button>
          <button type="button" class="accion-btn regresar"
            onclick="location.href='acciones-crud-citas-medicas.html'">REGRESAR</button>
        </div>
      </form>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Hospital San Paco. Todos los derechos reservados. | Contacto: <a
        href="mailto:info@sanpaco.com">info@sanpaco.com</a></p>
  </footer>

  <script>
    // Datos simulados de médicos (Coherente con crear.html)
    const medicosPorEspecialidad = {
      cardiologia: [{ codigo: "EMP-00145", nombre: "Dr. Carlos Mendoza" }],
      pediatria: [{ codigo: "EMP-00156", nombre: "Dra. Ana López" }],
      neurologia: [{ codigo: "EMP-00178", nombre: "Dr. Juan Pérez" }],
      dermatologia: [{ codigo: "EMP-00192", nombre: "Dra. María García" }],
      traumatologia: [{ codigo: "EMP-00201", nombre: "Dr. Roberto Silva" }],
      oftalmologia: [{ codigo: "EMP-00215", nombre: "Dra. Carmen Torres" }]
    };

    // Función para limpiar todos los campos
    function limpiarCampos() {
      // Inputs de texto y dates
      ['nombres-paciente', 'apellidos-paciente', 'tipo-doc-paciente', 'num-doc-paciente',
        'codigo-cita', 'fecha-cita', 'observaciones'].forEach(id => {
          let el = document.getElementById(id);
          if (el) el.value = '';
        });
      // Selects
      ['tipo-cita', 'especialidad', 'medico', 'hora-cita', 'estado-cita', 'motivo'].forEach(id => {
        let el = document.getElementById(id);
        if (el) el.value = '';
      });
      document.getElementById('medico').innerHTML = '<option value="">Seleccione médico...</option>';
      document.getElementById('hora-cita').innerHTML = '<option value="">Seleccione fecha y médico...</option>';
    }

    // Enter para buscar
    document.getElementById('input-busqueda').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        realizarBusqueda();
      }
    });

    function buscarCita(e) {
      e.preventDefault();
      realizarBusqueda();
    }

    function realizarBusqueda() {
      limpiarCampos();
      const valor = document.getElementById('input-busqueda').value.trim();
      const msg = document.getElementById('mensaje-busqueda');
      msg.textContent = '';
      msg.className = 'mensaje-paciente';

      if (!valor) {
        msg.textContent = 'Debe ingresar un dato de búsqueda.';
        msg.classList.add('error');
        return;
      }

      // --- SIMULACIÓN DE DATOS ENCONTRADOS ---
      // 1. Llenar datos paciente
      document.getElementById('nombres-paciente').value = 'Carolina Andrea';
      document.getElementById('apellidos-paciente').value = 'Gómez Rivas';
      document.getElementById('tipo-doc-paciente').value = 'Cédula de Ciudadanía (CC)';
      document.getElementById('num-doc-paciente').value = valor;

      // 2. Llenar datos cita básicos
      document.getElementById('codigo-cita').value = 'CIT-00982';
      document.getElementById('tipo-cita').value = 'consulta';

      // 3. Llenar Especialidad y Disparar carga de médicos
      document.getElementById('especialidad').value = 'cardiologia';
      filtrarMedicos(); // Carga la lista de médicos de cardiología

      // 4. Seleccionar al médico (debe existir en la lista recién cargada)
      document.getElementById('medico').value = 'EMP-00145';

      // 5. Llenar fecha y Disparar carga de horarios
      document.getElementById('fecha-cita').value = '2025-11-22';
      verificarDisponibilidad(); // Genera los slots de tiempo

      // 6. Seleccionar la hora (debe existir en los slots generados)
      document.getElementById('hora-cita').value = '10:20'; // Usamos un slot de 20 min

      // 7. Resto de datos
      document.getElementById('estado-cita').value = 'agendada';
      document.getElementById('motivo').value = 'control-general';
      document.getElementById('observaciones').value = 'Paciente solicita cambio de horario si es posible.';

      msg.textContent = 'Cita encontrada exitosamente.';
      msg.classList.add('exito');
    }

    // Lógica de Selects Dependientes (Igual a Crear, para mantener consistencia con Agenda)
    function filtrarMedicos() {
      const especialidad = document.getElementById("especialidad").value;
      const medicoSelect = document.getElementById("medico");
      medicoSelect.innerHTML = '<option value="">Seleccione médico...</option>';

      if (especialidad && medicosPorEspecialidad[especialidad]) {
        medicosPorEspecialidad[especialidad].forEach((medico) => {
          const option = document.createElement("option");
          option.value = medico.codigo;
          option.textContent = `${medico.nombre}`;
          medicoSelect.appendChild(option);
        });
      }
    }

    function cargarDisponibilidad() {
      verificarDisponibilidad();
    }

    function verificarDisponibilidad() {
      const medico = document.getElementById("medico").value;
      const fecha = document.getElementById("fecha-cita").value;
      const horaSelect = document.getElementById("hora-cita");

      // Guardar valor actual si estamos editando para no perderlo al regenerar
      const valorActual = horaSelect.value;

      if (medico && fecha) {
        // Slots de 20 minutos (Consistente con la Agenda creada)
        const horarios = [
          "08:00", "08:20", "08:40",
          "09:00", "09:20", "09:40",
          "10:00", "10:20", "10:40",
          "11:00", "11:20", "11:40",
          "14:00", "14:20", "14:40",
          "15:00", "15:20", "15:40",
          "16:00", "16:20", "16:40"
        ];

        horaSelect.innerHTML = '<option value="">Seleccione hora...</option>';
        horarios.forEach((hora) => {
          const option = document.createElement("option");
          option.value = hora;
          option.textContent = hora;
          horaSelect.appendChild(option);
        });

        // Intentar restaurar el valor si existe en la nueva lista
        if (valorActual) horaSelect.value = valorActual;
      }
    }

    function guardarCambios() {
      alert('Cambios guardados exitosamente.');
    }

    const observaciones = document.getElementById('observaciones');
    const contador = document.querySelector('.contador-caracteres');
    observaciones.addEventListener('input', function () {
      contador.textContent = `${this.value.length} / 500 caracteres`;
    });
  </script>
</body>

</html>