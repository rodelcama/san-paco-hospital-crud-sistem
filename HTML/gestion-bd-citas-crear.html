<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>San Paco | Crear Cita M√©dica B.D.</title>
    <link rel="stylesheet" href="../CSS/gestion-bd-citas-crear.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-logo-nombre-centro">
        <img src="../Images/logo.jpg" alt="Logo San Paco" class="navbar-logo" />
        <span class="navbar-title">Hospital San Paco</span>
      </div>
    </nav>

    <header>
      <div class="system-info titulos">
        <strong>Sistema de Informaci√≥n Web</strong>
        <span class="dashboard-title">San Paco Hospital CRUD System</span>
        <p>
          Agendamiento de Citas M√©dicas para los Pacientes del Hospital San
          Paco<br />Bogot√° D.C.
        </p>
      </div>
      <div class="modulo-header titulos">
        <h2>M√ìDULO 2. GESTI√ìN DE BASES DE DATOS</h2>
        <p class="breadcrumb">Citas M√©dicas - Crear</p>
      </div>
    </header>

    <main>
      <section class="gestion-section">
        <form
          class="gestion-form"
          autocomplete="off"
          onsubmit="guardarCita(event)"
        >
          <fieldset class="seccion">
            <legend>Identificaci√≥n de la Cita</legend>
            <label for="codigo-cita">C√≥digo de Cita M√©dica:</label>
            <input
              type="text"
              id="codigo-cita"
              name="codigo-cita"
              value="CIT-00245"
              disabled
              placeholder="C√≥digo de la cita"
            />
          </fieldset>

          <fieldset class="seccion seccion-paciente">
            <legend>Datos del Paciente</legend>

            <div class="buscar-paciente">
              <label for="id-paciente"
                >ID Paciente o N√∫mero de Documento:</label
              >
              <div class="input-buscar">
                <input
                  type="text"
                  id="id-paciente"
                  name="id-paciente"
                  placeholder="Ingrese c√≥digo o documento del paciente"
                  required
                />
                <button
                  type="button"
                  class="btn-buscar-paciente"
                  onclick="buscarPaciente()"
                >
                  üîç BUSCAR
                </button>
              </div>
              <div id="mensaje-paciente" class="mensaje-paciente"></div>
            </div>

            <label for="nombres-paciente">Nombres del Paciente:</label>
            <input
              type="text"
              id="nombres-paciente"
              name="nombres-paciente"
              disabled
              placeholder="Nombres"
            />

            <label for="apellidos-paciente">Apellidos del Paciente:</label>
            <input
              type="text"
              id="apellidos-paciente"
              name="apellidos-paciente"
              disabled
              placeholder="Apellidos"
            />

            <label for="tipo-doc-paciente">Tipo de Documento:</label>
            <input
              type="text"
              id="tipo-doc-paciente"
              name="tipo-doc-paciente"
              disabled
              placeholder="Tipo de documento"
            />

            <label for="num-doc-paciente">N√∫mero de Documento:</label>
            <input
              type="text"
              id="num-doc-paciente"
              name="num-doc-paciente"
              disabled
              placeholder="N√∫mero de documento"
            />
          </fieldset>

          <fieldset class="seccion">
            <legend>Tipo de Cita y Especializaci√≥n</legend>
            <label for="tipo-cita">Tipo de Cita M√©dica:</label>
            <select id="tipo-cita" name="tipo-cita" required>
              <option value="">Seleccione el tipo de cita...</option>
              <option value="primera-vez">Primera Vez</option>
              <option value="control">Control</option>
              <option value="consulta">Consulta</option>
              <option value="especialista">Especialista</option>
              <option value="urgencia">Urgencia</option>
            </select>
            <label for="especialidad">Especialidad:</label>
            <select
              id="especialidad"
              name="especialidad"
              onchange="filtrarMedicos()"
              required
            >
              <option value="">Seleccione la especialidad...</option>
              <option value="cardiologia">Cardiolog√≠a</option>
              <option value="pediatria">Pediatr√≠a</option>
              <option value="neurologia">Neurolog√≠a</option>
              <option value="dermatologia">Dermatolog√≠a</option>
              <option value="traumatologia">Traumatolog√≠a</option>
              <option value="oftalmologia">Oftalmolog√≠a</option>
            </select>
            <label for="medico">M√©dico:</label>
            <select
              id="medico"
              name="medico"
              onchange="cargarDisponibilidad()"
              required
            >
              <option value="">Primero seleccione una especialidad...</option>
            </select>
          </fieldset>

          <fieldset class="seccion">
            <legend>Programaci√≥n de la Cita</legend>
            <label for="fecha-cita">Fecha de la Cita:</label>
            <input
              type="date"
              id="fecha-cita"
              name="fecha-cita"
              onchange="verificarDisponibilidad()"
              required
            />
            <label for="hora-cita">Hora de la Cita:</label>
            <select id="hora-cita" name="hora-cita" required>
              <option value="">Seleccione fecha y m√©dico primero...</option>
            </select>
            <label for="estado-cita">Estado de la Cita:</label>
            <select id="estado-cita" name="estado-cita" required>
              <option value="agendada">Agendada</option>
              <option value="confirmada">Confirmada por paciente</option>
              <option value="en-espera">Paciente en espera</option>
              <option value="en-consulta">En consulta</option>
            </select>
          </fieldset>

          <fieldset class="seccion">
            <legend>Clasificaci√≥n y Observaciones</legend>
            <label for="motivo">Motivo de la Cita:</label>
            <select id="motivo" name="motivo" required>
              <option value="">Seleccione el motivo...</option>
              <option value="cita-recurrente">Cita Recurrente Mensual</option>
              <option value="cita-adicional">Cita Adicional</option>
              <option value="seguimiento">Seguimiento M√©dico</option>
              <option value="revision-resultados">
                Revisi√≥n de Resultados
              </option>
              <option value="otro">Otro</option>
            </select>
            <label for="observaciones">Observaciones:</label>
            <textarea
              id="observaciones"
              name="observaciones"
              rows="3"
              placeholder="Notas administrativas sobre la cita (m√°x. 500 caracteres)"
              maxlength="500"
            ></textarea>
            <div class="contador-caracteres">0 / 500 caracteres</div>
          </fieldset>

          <div class="botones-accion">
            <button type="submit" class="accion-btn guardar">
              GUARDAR CITA
            </button>
            <button type="button" class="accion-btn limpiar" id="limpiar-btn">
              LIMPIAR FORMULARIO
            </button>
            <button
              type="button"
              class="accion-btn regresar"
              onclick="location.href='acciones-crud-citas-medicas.html'"
            >
              REGRESAR
            </button>
          </div>
        </form>
      </section>
    </main>

    <footer>
      <p>
        ¬© 2025 Hospital San Paco. Todos los derechos reservados. | Contacto:
        <a href="mailto:info@sanpaco.com">info@sanpaco.com</a>
      </p>
    </footer>

    <script>
      // M√©dicos por especialidad
      const medicosPorEspecialidad = {
        cardiologia: [
          { codigo: "EMP-00145", nombre: "Dr. Carlos Mendoza" },
          { codigo: "EMP-00167", nombre: "Dra. Patricia Ruiz" },
        ],
        pediatria: [
          { codigo: "EMP-00156", nombre: "Dra. Ana L√≥pez" },
          { codigo: "EMP-00189", nombre: "Dr. Luis G√≥mez" },
        ],
        neurologia: [{ codigo: "EMP-00178", nombre: "Dr. Juan P√©rez" }],
        dermatologia: [{ codigo: "EMP-00192", nombre: "Dra. Mar√≠a Garc√≠a" }],
        traumatologia: [{ codigo: "EMP-00201", nombre: "Dr. Roberto Silva" }],
        oftalmologia: [{ codigo: "EMP-00215", nombre: "Dra. Carmen Torres" }],
      };

      function filtrarMedicos() {
        const especialidad = document.getElementById("especialidad").value;
        const medicoSelect = document.getElementById("medico");
        medicoSelect.innerHTML =
          '<option value="">Seleccione un m√©dico...</option>';
        if (especialidad && medicosPorEspecialidad[especialidad]) {
          medicosPorEspecialidad[especialidad].forEach((medico) => {
            const option = document.createElement("option");
            option.value = medico.codigo;
            option.textContent = `${medico.nombre} - ${medico.codigo}`;
            medicoSelect.appendChild(option);
          });
        }
        document.getElementById("hora-cita").innerHTML =
          '<option value="">Seleccione fecha y m√©dico primero...</option>';
      }

      function cargarDisponibilidad() {
        verificarDisponibilidad();
      }

      function verificarDisponibilidad() {
        const medico = document.getElementById("medico").value;
        const fecha = document.getElementById("fecha-cita").value;
        const horaSelect = document.getElementById("hora-cita");
        if (medico && fecha) {
          const horarios = [
            "08:00",
            "08:30",
            "09:00",
            "09:30",
            "10:00",
            "10:30",
            "11:00",
            "11:30",
            "14:00",
            "14:30",
            "15:00",
            "15:30",
            "16:00",
            "16:30",
            "17:00",
            "17:30",
          ];
          horaSelect.innerHTML =
            '<option value="">Seleccione un horario...</option>';
          horarios.forEach((hora) => {
            const option = document.createElement("option");
            option.value = hora;
            option.textContent = hora;
            horaSelect.appendChild(option);
          });
        }
      }

      // BUSCAR PACIENTE CON MENSAJE VISUAL
      function buscarPaciente() {
        const idPaciente = document.getElementById("id-paciente").value.trim();
        const msg = document.getElementById("mensaje-paciente");
        // Limpiar mensaje previo
        msg.textContent = "";
        msg.className = "mensaje-paciente";

        if (!idPaciente) {
          msg.textContent = "Por favor ingrese un ID o n√∫mero de documento.";
          msg.classList.add("error");
          limpiarCamposPaciente();
          return;
        }

        // Simulaci√≥n de b√∫squeda (datos de ejemplo):
        document.getElementById("nombres-paciente").value = "Juan Carlos";
        document.getElementById("apellidos-paciente").value = "Rodr√≠guez P√©rez";
        document.getElementById("tipo-doc-paciente").value =
          "C√©dula de Ciudadan√≠a (CC)";
        document.getElementById("num-doc-paciente").value = "1234567890";

        msg.textContent = "Paciente encontrado exitosamente.";
        msg.classList.add("exito");
      }

      // LIMPIAR FORMULARIO Y CAMPOS DESHABILITADOS
      function limpiarCamposPaciente() {
        document.getElementById("nombres-paciente").value = "";
        document.getElementById("apellidos-paciente").value = "";
        document.getElementById("tipo-doc-paciente").value = "";
        document.getElementById("num-doc-paciente").value = "";
      }

      document
        .getElementById("limpiar-btn")
        .addEventListener("click", function () {
          document.querySelector(".gestion-form").reset();
          limpiarCamposPaciente();
          const msg = document.getElementById("mensaje-paciente");
          msg.textContent = "";
          msg.className = "mensaje-paciente";
          // Tambi√©n puedes limpiar el contador si quieres:
          document.querySelector(".contador-caracteres").textContent =
            "0 / 500 caracteres";
        });

      function guardarCita(event) {
        event.preventDefault();
        const nombresPaciente =
          document.getElementById("nombres-paciente").value;
        if (!nombresPaciente) {
          document.getElementById("id-paciente").focus();
          const msg = document.getElementById("mensaje-paciente");
          msg.textContent =
            "Debe buscar y seleccionar un paciente antes de guardar la cita.";
          msg.classList.add("error");
          return;
        }
        alert(
          "¬°Cita m√©dica guardada exitosamente!\n\nEl paciente recibir√° una confirmaci√≥n."
        );
      }

      // Contador de caracteres
      const observaciones = document.getElementById("observaciones");
      const contador = document.querySelector(".contador-caracteres");
      observaciones.addEventListener("input", function () {
        const length = this.value.length;
        contador.textContent = `${length} / 500 caracteres`;
      });

      // Permitir BUSCAR con Enter en el input de b√∫squeda
      document
        .getElementById("id-paciente")
        .addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault(); // Evita enviar el formulario
            buscarPaciente();
            // Si la b√∫squeda fue exitosa, enfoca el selector de tipo de cita
            setTimeout(function () {
              if (
                document
                  .getElementById("mensaje-paciente")
                  .classList.contains("exito")
              ) {
                document.getElementById("tipo-cita").focus();
              }
            }, 50); // Da un peque√±o tiempo para que se actualice el mensaje
          }
        });
    </script>
  </body>
</html>
